@model List<allpax_sale_miner.ViewModels.vm_SalesCustomer>

@*@model IEnumerable<allpax_sale_miner.ViewModels.vm_SalesCustomer>*@

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<hr />
<h3 style="text-align:center">All Equipment Sales</h3>
<h4 style="text-align:center">
    <script>document.write(new Date().toLocaleDateString());</script>
</h4>
<hr />

@*Customer Equipment Sales*@
<head>
    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {//begin document read jquery statements

            //begin set up the data table
            var table = $('#datatable_eqpmnt_sales').DataTable({
                orderCellsTop: true,
                fixedHeader: true,
                paging: false,
                //"scrollY": "50vh",
                //"scrollX": true,
                //"scrollCollapse": true,
                order: [[0, "asc"]],
                searching: false
            });
                $('.dataTables_length').addClass('bs-select');
            //end set up the data table

            var queries = {};
            var nav_customerCode = '';
            //var jobNumbers = {};
            var jobNumbers = new Array();

            $.each(document.location.search.substr(1).split('&'), function (c, q) {
                var i = q.split('=');
                queries[i[0].toString()] = i[1].toString();
                nav_customerCode = queries[i[0].toString()];
            });

            @*alert(
                            //data.length
                           //Model.First().jobNoList.Count
                           "record count is: "+@Model.Count
            );*@

            //begin create the tabs
            $.ajax({
                url: 'DataService.asmx/GetJobNosByCustomerCode',
                method: 'post',
                async: false,
                data: { customerCode: nav_customerCode },
                dataType: 'json',
                success: function (data) {

                    $(data).each(function (index, item) {
                        var tempJobNo = item.jobNo.toString();
                        jobNumbers.push(item.jobNo.toString());

                        $("#tabTemplate").clone().prop("id", "tab_" + tempJobNo.toString()).appendTo("#jobNoTabs");

                        $("#tab_" + tempJobNo.toString()).removeAttr('hidden');//unhide the copy

                        $("#tab_" + tempJobNo.toString()).children().html(tempJobNo.toString());
                        $("#tab_" + tempJobNo).children().attr("id", tempJobNo+"-tab");
                        $("#tab_" + tempJobNo).children().attr("href", "#" + tempJobNo);

                        $("#home").clone().prop("id", tempJobNo.toString()).appendTo("#jobNoTabsContent");
                        $("#"+tempJobNo.toString()).removeAttr('hidden');//unhide the copy
                        $("#"+tempJobNo).attr("aria-labelledby", tempJobNo + "-tab".toString());                       

                        //$("#datatable_eqpmnt_salesTemplate").clone().prop("id", "datatable_eqpmnt_sales" + tempJobNo).appendTo("#" + tempJobNo);//clone and append a data table
                        $("#datatable_eqpmnt_salesTemplate").clone().prop("id", "datatable_eqpmnt_sales" + tempJobNo).appendTo("#" + tempJobNo);//clone and append a data table

                        //if (tempJobNo == 'J1000') {

                        //}

                        //$(".record").attr("class", "record_" + tempJobNo.toString());
                        //$(".record").attr("class", "record_" + item.jobNo);
                        $("#datatable_eqpmnt_sales" + tempJobNo).removeAttr('hidden');//unhide the copy

                        //$(".record").each(function (index) {
                        //    console.log(index + ": " + $(this).text());
                        //});

                        //$("tr td:nth-child(1)").each(function (index) {
                        //    console.log(index + ": " + $(this).text());
                        //});

                        //$("#datatable_eqpmnt_sales" + tempJobNo+ " tr td").each(function (index) {
                        //    console.log(index + ": " + $(this).text());
                        //});

                        //$("#datatable_eqpmnt_sales" + tempJobNo + " tr td:nth-child(1)").each(function (index) {

                        //    if (tempJobNo !== $(this).text()) {
                        //        $("#datatable_eqpmnt_sales" + tempJobNo + " tr").attr('hidden', '');
                        //        console.log("temp job no is: " + tempJobNo + " td value is: " + index + ": " + $(this).text()+" should be hidden.");
                        //}

                        //    console.log("temp job no is: "+tempJobNo+" td value is: "+index + ": " + $(this).text());
                        //});

                        //inside this loop is probably where i would begin nesting ajax calls for job numbers.
                    });

                    $.each(jobNumbers, function (index, val) {

                        $("#datatable_eqpmnt_sales" + val + " tr td:nth-child(1)").each(function (index) {

                            if (val !== $(this).text()) {
                                //$("#datatable_eqpmnt_sales" + val + " tr").attr('hidden', '');
                                $($(this)).parent().attr('hidden', '');
                                console.log("table is: datatable_eqpmnt_sales " + val + " td value is: " + index + ": " + $(this).text() + " should be hidden.");
                                //console.log("temp job no is: " + val + " td value is: " + index + ": " + $(this).text()+" should be hidden.");
                            }

                            //console.log("temp job no is: " + val + " td value is: " + index + ": " + $(this).text());
                            //console.log(val);
                        });

                        
                    });
                }
            });
            //end create the tabs

        });//end document read jquery statements
    </script>
</head>
<style>
    table {
        width: 100%;
        table-layout: fixed;
    }

    .kits {
        text-overflow: ellipsis;
        white-space: normal;
        overflow: visible;
        width: 30%;
        max-width: 30%;
    }
</style>
<div class="container-fluid">
    <div class="col-md-12" style="border:none">

        @*<h2>@Html.DisplayFor(modelItem => Model.First().jobNoList.Count)</h2>
        <h2>@Html.DisplayFor(modelItem => Model.First().jobNoList[0])</h2>
        <h2>@Html.DisplayFor(modelItem => Model.First().jobNoList[1])</h2>
        <h2>@Html.DisplayFor(modelItem => Model.First().jobNoList[2])</h2>*@

        @*<h2>@Model.First().jobNoList.Count</h2>
        <h2>@Model.Count</h2>*@

        @*<div class="row" id="jobNumTest" style="display:">
            <div class="col-md-2">
                jobNoList.Count: <input type="text" id="test" value=@Model.First().jobNoList.Count>
            </div>
        </div>*@

        @*@foreach (var item2 in Model)
        {
            for (var j = 0; j < (Model.First().jobNoList.Count); j++)
            {
                <button type="button" class="btn btn-primary btn-sm">@Html.DisplayFor(modelItem => item2.jobNoList[@j])</button>
            }
        }*@

        <ul class="nav nav-tabs" id="jobNoTabs" role="tablist">
            <li class="nav-item" id="tabTemplate">
                <a class="nav-link" id="intro-tab" data-toggle="tab" href="#intro" role="tab" aria-controls="intro"
                   aria-selected="true">Select a Job Number:</a>
            </li>
            <li class="nav-item" id="tabTemplate" hidden>
                <a class="nav-link" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home"
                   aria-selected="false">J1000 static</a>
            </li>
        </ul>
        <div class="tab-content" id="">
            <div class="tab-pane fade" id="intro" role="tabpanel" aria-labelledby="intro-tab">
            </div>
        </div>
        <div class="tab-content" id="jobNoTabsContent">
            <div class="tab-pane fade" id="home" role="tabpanel" aria-labelledby="home-tab">

            </div>
        </div><br />

        @*<div>
            <button class="btn btn-primary dropdown-toggle mr-4" type="button" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                Basic dropdown
            </button>

            <div class="dropdown-menu">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <a class="dropdown-item" href="#">Something else here</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Separated link</a>
            </div>
        </div>*@
       
        <div class="row">
            @*<div class="col-md-6" style="background-color:lavender; border: 1px solid black;">
                <div id="accordion">

                     <div class="card">
                        <div class="card-header" id="headingOne">
                            <h5 class="mb-0">
                                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    Equipment Model (Machine ID)
                                </button>
                            </h5>
                        </div>
                        <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                            <button type="button" class="btn btn-primary kitsInstalledButton" data-toggle="collapse" data-target="#kitsModal"
                                Kit ID
                            </button>
                        </div>                      
                    </div>

                    <div class="card">
                        <div class="card-header" id="headingTwo">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    Collapsible Group Item #2
                                </button>
                            </h5>
                        </div>
                        <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                            <div class="card-body">
                                Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo. Leggings occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably haven't heard of them accusamus labore sustainable VHS.
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" id="headingThree">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    Collapsible Group Item #3
                                </button>
                            </h5>
                        </div>
                        <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                            <div class="card-body">
                                Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo. Leggings occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably haven't heard of them accusamus labore sustainable VHS.
                            </div>
                        </div>
                    </div>

                </div>
            </div>*@
            <div class="col-md-12">   
                <form>
                    <label >Default input</label>
                    <label >Default input</label>
                </form>
            </div>
        </div>

        <table id="datatable_eqpmnt_salesTemplate" class="table table-striped table-bordered" hidden>
            <thead>
                <tr>
                    <th class="th-sm" hidden>
                        Job Number
                    </th>
                    <th class="th-sm">
                        Customer (Customer Code)
                    </th>
                    <th class="th-sm">
                        Model
                    </th>
                    <th class="th-sm">
                        Machine ID
                    </th>
                    <th class="th-sm">
                        Current Kits
                    </th>
                    <th class="th-sm">
                        Available Kits
                    </th>
                    @*<th class="th-sm">
                        Job List
                    </th>*@
                </tr>
            </thead>
            <tbody>

                @foreach (var item in Model)

                {

                    <tr class="record" id="">
                        <td id="" value=@Html.DisplayFor(modelItem => item.jobNo) hidden>@Html.DisplayFor(modelItem => item.jobNo)</td>
                        <td id="" value=@Html.DisplayFor(modelItem => item.name)>@Html.DisplayFor(modelItem => item.name) (@Html.DisplayFor(modelItem => item.customerCode))</td>
                        <td id="" value=@Html.DisplayFor(modelItem => item.model)>@Html.DisplayFor(modelItem => item.model)</td>
                        <td id="" value=@Html.DisplayFor(modelItem => item.machineID)>@Html.DisplayFor(modelItem => item.machineID)</td>
                        <td class="kits">
                            @for (var i = 0; i < (item.kitsCurrent.Count); i++)
                            {
                                <span>@Html.DisplayFor(modelItem => item.kitsCurrent[@i]), </span>
                            }
                        </td>
                        <td class="kits">
                            @for (var i = 0; i < (item.kitsAvlblbNotInstld.Count); i++)
                            {
                                <span>@Html.DisplayFor(modelItem => item.kitsAvlblbNotInstld[@i]), </span>
                            }
                        </td>
                        @*<td class="kits">
                            @for (var i = 0; i < (item.jobNoList.Count); i++)
                            {
                                <span>@Html.DisplayFor(modelItem => item.jobNoList[@i]), </span>
                            }
                        </td>*@
                    </tr>
                }
        </table>
    </div>
</div>






